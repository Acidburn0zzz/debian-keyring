#!/usr/bin/make -f

build:
	$(MAKE)
	# This won't fully exersise the test suite; some tests need to be
	# online to download the Debian keyring, for example. Recommend
	# running make test by hand from time to time to fully test it.
	ONLINE=n $(MAKE) test

clean:
	dh_testdir
	dh_testroot
	$(MAKE) distclean
	dh_clean

binary-arch: build

VER = $(shell dpkg-parsechangelog | sed -ne 's/^Version: //p')

binary-indep: build
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_install debian-maintainers.gpg usr/share/keyrings/
	dh_installdocs README TODO
	dh_installexamples sample.changeset
	dh_installchangelogs
	dh_compress
	dh_fixperms
	dh_installdeb
	dh_gencontrol
	dh_md5sums
	dh_builddeb

	# byhand file for dak
	cp debian-maintainers.gpg ../debian-maintainers_$(VER)_all.gpg
	dpkg-distaddfile debian-maintainers_$(VER)_all.gpg raw-keyring -

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary
